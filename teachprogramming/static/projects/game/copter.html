<!DOCTYPE html><html>
<head>
    <meta charset="utf-8" />
    <link id="favicon" rel="shortcut icon" type="image/png" href="data:image/png;base64,....==" />
</head><body></body>
<script type="module">
import {CanvasAnimationBase, Gfx, createFullScreenCanvasElement} from './animation_base.js'

class Copter extends CanvasAnimationBase {
    constructor() {
        super(...arguments)
        this.load_image(`background_0`, `images/CopterLevel1.png`)           // VER: background NOT parallax
        this.load_image("copter_image", "images/ship.gif")                   // VER: copter
        this.copter_collision_points = [[0,0],[32,9],[17,2],[22,12],[2,12]]  // VER: collision_multi
        this.level_color = (255, 255, 0, 255)                                // VER: level
        this.level_number = 1                                                // VER: level
        this.load_level()                                                    // VER: level
        //this.reset()                                                       // VER: level NOT_
    }
    load_level() {                                                                     // VER: level
        this.load_image(`background_2`, `images/CopterLevel${this.level_number}_layer2.png`)  // VER: parallax
        this.load_image(`background_1`, `images/CopterLevel${this.level_number}_layer1.png`)  // VER: parallax
        this.load_image(`background_0`, `images/CopterLevel${this.level_number}.png`)  // VER: level
        this._collisions_context = undefined                                           // VER: collision_single
        this.reset()                                                                   // VER: level
    }                                                                                  // VER: level
    reset() {
        this.background_x_pos = 0 // VER: background
        this.copter_x_pos = 50    // VER: copter
        this.copter_y_pos = 100   // VER: copter
        this.copter_x_vel = 0     // VER: physics
        this.copter_y_vel = 0     // VER: physics
    }
    generateOffscreenContext(img){      // VER: collision_single
        const o = new OffscreenCanvas(img.width, img.height)  // VER: collision_single
        const c = o.getContext("2d")    // VER: collision_single
        c.drawImage(img, 0,0)           // VER: collision_single
        return c                        // VER: collision_single
    }                                   // VER: collision_single
    get collisions_context() {          // VER: collision_single
        if (this._collisions_context) {return this._collisions_context}         // VER: collision_single
        if (this.images.background_0?.complete) {                               // VER: collision_single
            return this._collisions_context = this.generateOffscreenContext(this.images.background_0) // VER: collision_single
        }                                                                       // VER: collision_single
    }                                                                           // VER: collision_single
    safeGetBackgroundPixel(x,y) {                                               // VER: collision_single
        return this.collisions_context?.getImageData(x+this.background_x_pos, y, 1, 1).data  // VER: collision_single
    }                                                                           // VER: collision_single
    model_inc(frame) {
        this.background_x_pos += 1   // VER: background
                                     // VER: background
        //if (this.keys_pressed.has('Space')) {self.copter_y_pos += -2}  // VER: copter NOT physics
        //else                                {self.copter_y_pos +=  1}  // VER: copter NOT physics
        if (this.keys_pressed.has('ArrowUp'))    {this.copter_y_vel += -0.1} // VER: physics
        if (this.keys_pressed.has('ArrowDown'))  {this.copter_y_vel +=  0.1} // VER: physics
        if (this.keys_pressed.has('ArrowLeft'))  {this.copter_x_vel += -0.1} // VER: physics HIDE
        if (this.keys_pressed.has('ArrowRight')) {this.copter_x_vel +=  0.1} // VER: physics HIDE
                                                       // VER: copter
        this.copter_x_vel  = this.copter_x_vel * 0.99  // VER: physics
        this.copter_y_vel  = this.copter_y_vel * 0.99  // VER: physics
        this.copter_y_vel += 0.025                     // VER: physics
        this.copter_x_pos += this.copter_x_vel         // VER: physics
        this.copter_y_pos += this.copter_y_vel         // VER: physics
                                                       // VER: physics
        for (let [x,y] of this.copter_collision_points) {     // VER: collision_multi
        //if (true) {                                         // VER: collision_single NOT collision_multi
            //const [r,g,b,a] = this.safeGetBackgroundPixel(this.copter_x_pos+x, this.copter_y_pos+y) // VER: collision_single NOT collision_multi
            const [r,g,b,a] = this.safeGetBackgroundPixel(this.copter_x_pos+x, this.copter_y_pos+y)   // VER: collision_multi
            const pixel_color = `rgba(${r},${g},${b},${a})`;  // VER: collision_single
            if (a < 128) {}                                   // VER: collision_single
            else if (pixel_color == this.level_color) {           // VER: level
                this.level_number += 1                            // VER: level
                this.load_level()                                 // VER: level
            }                                                     // VER: level
            else {this.reset()}                               // VER: collision_single
        }                                                     // VER: collision_single
    }
    draw(context, frame) {
        this.clear()
        //context.drawImage(this.images['background_0'], -this.background_x_pos, 0)  // VER: background NOT parallax
        for (let layer of [2,1,0]) { // VER: parallax
            context.drawImage(this.images[`background_${layer}`], Math.round(-this.background_x_pos/Math.pow(2,layer)), 0) // VER: parallax
        } // VER: parallax
        context.drawImage(this.images['copter_image'], Math.round(this.copter_x_pos), Math.round(this.copter_y_pos)) // VER: copter
    }
}
(new Copter({
    canvas: createFullScreenCanvasElement({width:640, height:360}),
})).setRunning(true)
</script></html>
